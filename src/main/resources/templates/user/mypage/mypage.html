            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8" />
                <title>My page</title>
                <link
                        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
                        rel="stylesheet"
                />
                <style>
                    /* ========== Tokens ========== */
                    :root {
                        --line: #e2e8f0;
                        --muted: #6b7280;
                        --brand: #2563eb;
                        --brand-weak: #e6efff;
                        --danger: #ef4444;
                        --shadow: 0 6px 18px rgba(2, 6, 23, 0.06);
                        --preview-color: rgba(99, 179, 237, 0.25); /* í”„ë¦¬ë·° ë°•ìŠ¤ ë°°ê²½ */
                    }

                    /* ========== Base ========== */
                    body {
                        margin: 0;
                        padding: 0;
                        font-family: 'Montserrat', sans-serif;
                        background-color: #f7f9fc;
                        min-height: 100vh;
                        display: flex;
                        flex-direction: column;
                    }

                    header {
                        padding: 20px;
                        box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1);
                        background-color: rgba(255, 255, 255, 0.85);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid #e2e8f0;
                    }

                    h1 {
                        font-size: 2.3rem;
                        font-weight: bold;
                        color: var(--brand);
                        margin: 0;
                    }
                    h1 a {
                        text-decoration: none;
                        color: inherit;
                    }

                    nav a {
                        margin-left: 20px;
                        text-decoration: none;
                        color: #333;
                        font-weight: 500;
                        transition: color 0.2s ease, font-size 0.2s ease;
                    }
                    nav a:hover {
                        color: #3b82f6;
                        font-size: 1.1rem;
                    }

                    main { flex: 1; padding: 20px 0; }

                    /* ========== Layout (Grid) ========== */
                    .container {
                        display: grid;
                        grid-template-columns: 2fr 1fr; /* ì¢Œ: ëŒ€í‘œ(ë„“ê²Œ) / ìš°: ì‚¬ì´ë“œ */
                        gap: 16px;
                        max-width: 1200px;
                        width: 100%;
                        margin: 0 auto;
                        padding: 20px 16px;
                    }
                    .sidebar {
                        display: flex;
                        flex-direction: column;
                        gap: 16px;
                    }
                    @media (max-width: 900px) {
                        .container { grid-template-columns: 1fr; }
                    }

                    /* ========== Cards / Boxes ========== */
                    .box {
                        background: #fff;
                        border: 1px solid var(--line);
                        border-radius: 14px;
                        padding: 16px 18px;
                        box-shadow: var(--shadow);
                        display: flex;
                        flex-direction: column;
                        min-height: 160px;
                        box-sizing: border-box;
                        transition: transform .3s ease, box-shadow .3s ease;
                    }
                    .box3 { min-height: 220px; }
                    .box:hover {
                        transform: translateY(-4px);
                        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
                    }
                    .sidebar .box + .box { margin-top: 5px; }

                    .box .card-title {
                        display: flex; align-items: center; gap: 10px;
                        margin: 0 0 12px;
                        font-size: 16px; font-weight: 800;
                    }
                    .box .card-title .icon {
                        display: inline-flex; align-items: center; justify-content: center;
                        width: 28px; height: 28px;
                        border-radius: 8px; background: var(--brand-weak);
                        font-size: 16px;
                    }

                    /* ========== Typography / Sections ========== */
                    h2, h3 { margin: 0 0 10px; font-size: 1.1rem; color: #111827; }
                    .section { margin-bottom: 10px; }
                    .info p { margin: 3px 0; font-size: .9rem; color: #374151; }

                    /* ì œëª©-ì•¡ì…˜ ê°€ë¡œ ì •ë ¬ */
                    .section-header {
                        display: flex; align-items: center; justify-content: space-between; gap: 12px;white-space: nowrap;
                    }
                    .section-header h3 { margin: 0; line-height: 1.3; transform: translateY(-3px); }
                    .section-header .actions { display: flex; gap: 8px; }
                    .section-header .actions button {
                        padding: 12px 20px !important;   /* ê°•ì œ ì ìš© */
                        border-radius: 10px !important;
                        font-size: 0.9rem !important;
                        font-weight: 500;
                        height: auto !important;                   /* ì¼ì •í•œ ë†’ì´ */
                        display: flex;
                        align-items: center;}
                    .section-header .actions button:hover {
                        transform: translateY(-1px);
                        opacity: .9;
                    }

                    /* ========== Buttons ========== */
                    button {
                        background-color: var(--brand);
                        color: #1f2937;
                        border: 1px solid transparent;
                        padding: 12px 20px;
                        border-radius: 10px;
                        font-size: .9rem;
                        cursor: pointer;
                        transition: background-color .25s ease, transform .25s ease;
                    }
                    /* Hover ì‹œ ê³µí†µ ì• ë‹ˆë©”ì´ì…˜ */
                    button:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 8px rgba(0,0,0,0.12);
                    }

                    /* ========== Danger (ë¹¨ê°•) ========== */
                    button.red {
                        background-color: var(--danger);
                        color: #fff;
                        border-color: #dc2626;
                    }

                    button.red:hover {
                        background-color: #c81e1e;
                    }

                    /* ========== Gray (ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë²„íŠ¼) ========== */
                    button.gray-btn {
                        background-color: #4b5563;
                        color: #fff;
                        border-color: #4b5563;
                    }

                    button.gray-btn:hover {
                        background-color: #374151;  /* í˜¸ë²„ ì‹œ ë” ì§„í•œ íšŒìƒ‰ */
                        border-color: #374151;
                    }

                    /* ========== Representative Schedule Container ========== */
                    .representative-container { width: 100%; }
                    .representative-box {
                        background-color: #fff;
                        border-radius: 10px;
                        box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);
                        padding: 30px; box-sizing: border-box;
                    }
                    /* ëŒ€í‘œ ì‹œê°„í‘œ í­ ì§€ì • & ì¤‘ì•™ ì •ë ¬ */
                    #repGridCard { width: 750px; margin: 0 auto; }

                    /* ========== Footer ========== */
                    footer {
                        background-color: rgba(30, 30, 30, 0.98);
                        color: rgba(200, 200, 200, 0.7);
                        font-size: .9rem;
                        padding: 2rem 1rem;
                        text-align: center;
                        border-top: 1px solid #444;
                        margin-top: auto;
                    }
                    footer a { text-decoration: none; color: rgba(200, 200, 200, 0.7); margin: 0 10px; }
                    footer a:hover { text-decoration: underline; }

                    /* ========== Select (Custom) ========== */
                    select {
                        appearance: none; -webkit-appearance: none; -moz-appearance: none;
                        background-color: #fff;
                        border: 1px solid #cbd5e1;
                        border-radius: 8px;
                        padding: 10px 14px;
                        font-size: 1rem; color: #111827;
                        font-family: 'Montserrat', sans-serif;
                        cursor: pointer;
                        transition: border-color .2s ease, box-shadow .2s ease;
                        background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
                        background-repeat: no-repeat;
                        background-position: right 12px center;
                        background-size: 16px 16px;
                        padding-right: 40px;
                    }
                    select:hover { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37,99,235,.2); }
                    select:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 3px rgba(37,99,235,.3); }

                    /* ========== Modal ========== */
                    .modal-overlay {
                        position: fixed; inset: 0;
                        background-color: rgba(0,0,0,0.5);
                        display: flex; justify-content: center; align-items: center;
                        z-index: 1000;
                    }
                    .modal-wrapper { display: contents; }
                    .modal {
                        background: #fff; border-radius: 12px;
                        padding: 24px 32px;
                        max-width: 400px; width: 90%;
                        box-shadow: 0 6px 24px rgba(0,0,0,.2);
                        text-align: center;
                        display: flex; flex-direction: column; gap: 16px;
                    }
                    .modal-buttons {
                        display: flex; justify-content: center; gap: 12px; margin-top: 8px;
                    }
                    .modal-buttons button {
                        flex: 1; max-width: 120px;
                        padding: .6rem 0; border-radius: 8px; font-size: .95rem;
                        transition: transform .15s, box-shadow .15s, opacity .15s;
                    }
                    .modal-buttons #confirm,
                    .modal-buttons #changePwBtn { background-color: var(--brand); color: #fff; }
                    .modal-buttons #close-btn,
                    .modal-buttons #cancelChange { background-color: #e0e0e0; color: #333; }
                    .modal-buttons button:hover { transform: translateY(-1px); opacity: .9; }
                    .modal-buttons button:active { transform: translateY(1px); }
                    .modal input[type='password'] {
                        width: 100%; padding: .75rem 1rem;
                        border: 1px solid #ccc; border-radius: 8px; font-size: 1rem;
                        box-sizing: border-box;
                    }
                    .hidden { display: none; }
                    body.modal-open { overflow: hidden; }

                    /* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ / ë³€ê²½ ëª¨ë‹¬ ì „ìš© */
                    .pw-modal {
                        max-width: 440px;                 /* ê¸°ì¡´ 400ë³´ë‹¤ ì¡°ê¸ˆ ë” í¼ */
                        width: min(440px, 94vw);
                    }

                    .pw-modal p {
                        margin: 0 0 8px;
                        font-weight: 600;
                        font-size: 0.98rem;
                    }

                    .pw-modal input[type='password'] {
                        width: 100%;
                        padding: 0.7rem 0.9rem;
                        border: 1px solid #d1d5db;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        box-sizing: border-box;
                    }

                    /* === ì´ìš©ì•ˆë‚´ ëª¨ë‹¬ ì¶”ê°€ ë¶€ë¶„ 11.24 ìˆ˜ì • === */
                    .guide-backdrop {
                        position: fixed; inset: 0;
                        background: rgba(0,0,0,0.45);
                        backdrop-filter: blur(2px);
                        display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
                        align-items: center; justify-content: center;
                        z-index: 9999;
                    }
                    .guide-backdrop.open { display: flex; }

                    .guide-modal {
                        width: min(820px, 92vw);
                        max-height: 86vh;
                        overflow: auto;
                        background: #ffffff;
                        border-radius: 24px;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.25);
                        text-align: left;
                    }

                    .guide-head {
                        position: sticky; top: 0;
                        background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.9));
                        padding: 20px 24px;
                        border-bottom: 1px solid #e5e7eb;
                        display: flex; align-items: center; gap: 12px;
                        border-top-left-radius: 24px; border-top-right-radius: 24px;
                    }
                    .guide-title {
                        font-size: 1.25rem; font-weight: 700; color: #2563eb; margin: 0;
                        letter-spacing: 0.2px;
                    }
                    .guide-close {
                        margin-left: auto;
                        border: 0; background: #2563eb; color: #fff;
                        padding: 8px 12px; border-radius: 10px; cursor: pointer;
                        font-weight: 700;
                    }
                    .guide-close:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(37,99,235,0.3); }

                    .guide-body { padding: 18px 24px 26px; line-height: 1.65; color: #111827; }
                    .guide-section { margin: 18px 0 22px; }
                    .guide-section h3 { margin: 0 0 10px; font-size: 1.05rem; color: #374151; }
                    .guide-section p, .guide-section li { font-size: 0.95rem; }

                    .guide-steps {
                        display: grid; gap: 12px;
                    }
                    .step {
                        background: #f8fafc;
                        border: 1px solid #e5e7eb;
                        border-radius: 14px;
                        padding: 12px 14px;
                    }
                    .step strong { color: #111827; }

                    .guide-footer {
                        position: sticky; bottom: 0;
                        background: linear-gradient(0deg, rgba(255,255,255,0.98), rgba(255,255,255,0.9));
                        border-top: 1px solid #e5e7eb;
                        padding: 12px 16px;
                        display: flex; gap: 8px; justify-content: flex-end;
                        border-bottom-left-radius: 24px; border-bottom-right-radius: 24px;
                    }
                    .guide-secondary {
                        border: 1px solid #d1d5db; background: #fff; color: #374151;
                        padding: 10px 14px; border-radius: 10px; font-weight: 600; cursor: pointer;
                    }
                    .guide-primary {
                        border: 0; background: #60a5fa; color: #fff;
                        padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer;
                    }
                    .guide-primary:hover, .guide-secondary:hover { transform: translateY(-1px); }

                    /* ========== Semester List ========== */
                    #semesterList { list-style: none; padding-left: 0; margin: 12px 0 0 0; }
                    #semesterList li {
                        margin: 5px 0;
                        display: flex; justify-content: space-between; align-items: center;
                    }
                    #semesterList .semester-item {
                        display: flex; align-items: center; justify-content: space-between; gap: 14px;
                        border: 1px solid #e5e7eb; border-radius: 10px;
                        padding: 10px 14px; background: #fff;
                        transition: background-color .15s ease, box-shadow .15s ease, border-color .15s ease;
                        cursor: pointer; width: 80%;
                    }
                    #semesterList .semester-item:hover {
                        background: #f9fafb; border-color: #d1d5db; box-shadow: 0 4px 12px rgba(0,0,0,.04);
                    }
                    #semesterList .semester-name { color: #111827; text-decoration: none; font-weight: 600; }
                    #semesterList .semester-actions { display: flex; align-items: center; gap: 10px; }
                    #semesterList .rep-label { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; }
                    #semesterList .del-btn {
                        background: transparent; border: none; cursor: pointer; padding: 4px;
                        display: flex; align-items: center; justify-content: center;
                    }
                    /* ë”ë³´ê¸° ë²„íŠ¼ */
                    .hidden-semester { display: none !important; }
                    #showMoreBtn {
                        margin-top: 10px; width: 100%;
                        background: #f3f4f6;
                        border: 1px solid #e5e7eb; color: #111827;
                        border-radius: 10px; padding: 8px 12px; cursor: pointer; font-size: .92rem;
                    }
                    #showMoreBtn:hover { background: #eceff3; }

                    /* ========== Course Tooltip ========== */
                    /* ========== Course Tooltip ========== */
                    .course-tooltip {
                        position: absolute;
                        z-index: 2000;
                        min-width: 180px;

                        background: #ffffff;
                        border-radius: 12px;
                        border: 1px solid rgba(37, 99, 235, 0.25);
                        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.16);

                        padding: 10px 12px;
                        font-size: 0.86rem;
                        color: #0f172a;
                        pointer-events: none;

                        animation: fadeIn .12s ease-out;
                    }

                    /* í—¤ë”: ê³¼ëª©ëª… + í•™ìˆ˜ë²ˆí˜¸/êµ¬ë¶„ + í•™ì  ë±ƒì§€ */
                    .course-tooltip-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        gap: 8px;
                        margin-bottom: 6px;
                    }

                    .course-tooltip-title {
                        font-size: 0.95rem;
                        font-weight: 700;
                        color: #111827;
                        line-height: 1.3;
                    }

                    .course-tooltip-sub {
                        margin-top: 2px;
                        font-size: 0.78rem;
                        color: #6b7280;
                    }

                    .course-tooltip-sub .dot {
                        margin: 0 4px;
                    }

                    .course-tooltip-credit {
                        font-size: 0.76rem;
                        padding: 3px 7px;
                        border-radius: 999px;
                        background: #eff6ff;
                        color: #1d4ed8;
                        font-weight: 600;
                        white-space: nowrap;
                    }

                    /* ë°”ë””: êµìˆ˜ / ê°•ì˜ì‹¤ / ì‹œê°„ / êµ¬ë¶„ */
                    .course-tooltip-body {
                        border-top: 1px dashed #e5e7eb;
                        padding-top: 6px;
                    }

                    .course-tooltip-row {
                        display: flex;
                        justify-content: space-between;
                        gap: 8px;
                        margin-top: 3px;
                    }

                    .course-tooltip-row .label {
                        font-size: 0.78rem;
                        color: #9ca3af;
                    }

                    .course-tooltip-row .value {
                        font-size: 0.8rem;
                        color: #111827;
                        text-align: right;
                    }

                    /* ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
                    @keyframes fadeIn {
                        from {
                            opacity: 0;
                            transform: translateY(8px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }


                    /* ========== Tech Tree Small Cards ========== */
                    .details-container {
                        display: grid;
                        grid-template-columns: repeat(4, minmax(0, 1fr));
                        gap: 10px; margin-top: 10px;
                    }
                    @media (max-width: 420px) {
                        .details-container { grid-template-columns: repeat(2, 1fr); }
                    }
                    .detail {
                        border: 1px solid var(--line); border-radius: 10px; background-color: #fff;
                        height: 70px; display: flex; flex-direction: column; justify-content: center; align-items: center;
                        box-shadow: 0 2px 6px rgba(0,0,0,.1);
                        transition: transform .2s ease-in-out, box-shadow .2s ease-in-out;
                    }
                    .detail:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,.15); cursor: pointer; }
                    .detail .label { font-size: 17px; font-weight: bold; margin-bottom: 4px; }
                    .detail .value { font-size: 20px; font-weight: 700; color: #007bff; }

                    .box .desc-list { margin: 8px 0 14px; }
                    .box .desc-list div { display: flex; gap: 10px; padding: 6px 0; border-bottom: 1px dashed var(--line); }
                    .box .desc-list dt { width: 66px; color: var(--muted); font-weight: 700; }
                    .box .desc-list dd { margin: 0; }
                    .box2 .subtext, .box3 .subtext {
                        font-size: .85rem; line-height: 1.4; color: var(--muted); margin-top: 4px;
                    }

                    /* ========== Schedule (Grid-based) ========== */
                    /* ì‹œê°„í‘œ ëª¨ë‹¬ ì „ìš© (ê°€ë¡œë¡œ ë„“ê²Œ ì‚¬ìš©) */
                    .schedule-modal {
                        max-width: 980px;
                        width: min(980px, 96vw);
                        flex-direction: row;   /* ì‹œê°„í‘œ ëª¨ë‹¬ì€ ê°€ë¡œ ë ˆì´ì•„ì›ƒ ìœ ì§€ */
                    }

                    .schedule-card {
                        border: 1px solid var(--line);
                        border-radius: 14px;
                        overflow: hidden;
                        background: #fff;
                        box-shadow: var(--shadow);
                    }
                    .schedule-header {
                        display: grid; grid-template-columns: 120px repeat(5, 1fr);
                        background: #f9fbff; border-bottom: 1px solid var(--line);
                    }
                    .schedule-header > div { padding: 12px; font-weight: 700; text-align: center; }
                    .schedule-body { display: flex; flex-direction: column; }

                    /* Grid ë³¸ì²´ */
                    .schedule-grid {
                        display: grid;
                        grid-template-columns: 120px repeat(5, 1fr); /* ì‹œê°„ì—´ + ì›”~ê¸ˆ */
                        grid-auto-rows: 80px;                        /* êµì‹œ ë†’ì´ (ëª¨ë‹¬/ëŒ€í‘œì—ì„œ JSë¡œ ì¡°ì • ê°€ëŠ¥) */
                        grid-auto-flow: row dense;
                        position: relative;
                        background: #fff;
                        border-top: 1px solid var(--line);
                        border-left: 1px solid var(--line);
                    }

                    /* ì™¼ìª½ ì‹œê°„ ì…€ */
                    .time-cell {
                        display: flex; flex-direction: column; align-items: center; justify-content: center;
                        font-weight: 700; font-size: 14px;
                        background: #fbfbfb;
                        border-bottom: 1px solid var(--line);
                        border-right: 1px solid var(--line);
                    }
                    .time-cell span { color: var(--muted); font-weight: 600; }

                    /* ë¹ˆ ìë¦¬(ê²©ì) */
                    .cell-placeholder {
                        border-right: 1px solid var(--line);
                        border-bottom: 1px solid var(--line);
                        position: relative;
                    }

                    /* 1. ì‹œê°„í‘œ ì „ì²´ ì»¨í…Œì´ë„ˆ ë° ì œëª© ìŠ¤íƒ€ì¼ */
                    .timetable-container {
                        width: 100%;
                        max-width: 1000px; /* í™”ë©´ í­ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘ */
                        margin: 40px auto;
                        background-color: #ffffff;
                        border-radius: 12px; /* ê¹”ë”í•˜ê³  ë¶€ë“œëŸ¬ìš´ ëª¨ì„œë¦¬ */
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); /* ì€ì€í•œ ê·¸ë¦¼ìë¡œ ì¹´ë“œì˜ ëŠë‚Œ */
                        font-family: 'Inter', sans-serif; /* ê¸°ë³¸ í°íŠ¸ë¥¼ Interë¡œ ì„¤ì •í•˜ì—¬ í˜„ëŒ€ì ì¸ ëŠë‚Œ ê°•ì¡° */
                        padding: 24px;
                    }

                    /* ì œëª© ì˜ì—­ */
                    .timetable-title {
                        padding: 10px 0 25px 0;
                        font-size: 22px;
                        font-weight: 700;
                        color: #374151;
                        display: flex;
                        align-items: center;
                    }
                    .timetable-title .pin {
                        color: #ef4444; /* í•€ ìƒ‰ìƒ ê°•ì¡° */
                        margin-right: 8px;
                        font-size: 1.2em;
                    }

                    /* 2. ì‹œê°„í‘œ í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ê·¸ë¦¬ë“œ) */
                    .timetable {
                        width: 100%;
                        border-collapse: collapse; /* ê¹”ë”í•œ ê·¸ë¦¬ë“œ ë¼ì¸ ì²˜ë¦¬ */
                    }

                    /* ìš”ì¼ í—¤ë” (ì›”, í™”, ìˆ˜, ëª©, ê¸ˆ) */
                    .timetable th {
                        font-size: 14px;
                        font-weight: 600;
                        color: #4b5563;
                        padding: 15px 5px;
                        text-align: center;
                        border-bottom: 2px solid #e5e7eb; /* ìš”ì¼ ì•„ë˜ì—ë§Œ êµµì€ êµ¬ë¶„ì„  */
                        background-color: #f9fafb; /* í—¤ë”ì— ì•„ì£¼ ì—°í•œ ë°°ê²½ìƒ‰ */
                    }

                    /* ì²« ë²ˆì§¸ ì—´ (êµì‹œ ë° ì‹œê°„ ì •ë³´) */
                    .timetable td:first-child {
                        font-size: 13px;
                        font-weight: 500;
                        color: #6b7280;
                        padding: 10px 15px;
                        text-align: left;
                        white-space: nowrap;
                        border-right: 1px solid #f3f4f6; /* êµì‹œ ì •ë³´ì™€ ì‹œê°„í‘œ ë³¸ë¬¸ ë¶„ë¦¬ */
                    }

                    /* ëª¨ë“  í–‰ì˜ ìˆ˜í‰ êµ¬ë¶„ì„  */
                    .timetable tr {
                        border-bottom: 1px solid #f3f4f6; /* ëª¨ë“  í–‰ì„ ì–‡ì€ ì„ ìœ¼ë¡œ êµ¬ë¶„ */
                    }
                    .timetable tr:last-child {
                        border-bottom: none;
                    }

                    /* ê³¼ëª©ì´ ë°°ì¹˜ë˜ëŠ” ì…€ */
                    .timetable td {
                        padding: 4px; /* ê³¼ëª© ë¸”ë¡ì„ ìœ„í•œ ìµœì†Œ íŒ¨ë”© */
                        vertical-align: top;
                        height: 70px; /* ê° êµì‹œ ì…€ì˜ ë†’ì´ í™•ë³´ */
                    }

                    /* 3. ê³¼ëª© ë¸”ë¡ (ìµœì‹  ë¯¸ë‹ˆë©€ ë””ìì¸) */
                    .course-block {
                        border-radius: 8px; /* ì ë‹¹í•œ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
                        border: 1px solid transparent; /* ê¸°ë³¸ í…Œë‘ë¦¬ ì œê±° */
                        box-shadow: none; /* ê·¸ë¦¼ì ì œê±°: ê¹”ë”í•¨ ê·¹ëŒ€í™” */
                        color: #1f2937;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 12px 10px;
                        text-align: center;
                        overflow: hidden;
                        box-sizing: border-box;
                        height: 100%;
                        transition: all 0.2s ease-in-out;
                    }

                    /* ì‹¤ì œ ë°°ì¹˜ëœ ë¸”ë¡ ìŠ¤íƒ€ì¼ (ìƒ‰ìƒ í•˜ì´ë¼ì´íŠ¸ ì§‘ì¤‘) */
                    .course-block.busy {
                        --c: var(--course-color, #a5b4fc); /* ì£¼ ìƒ‰ìƒ ë³€ìˆ˜ */

                        /* ë°°ê²½: ì£¼ ìƒ‰ìƒì˜ ë§¤ìš° ì—°í•œ ë²„ì „ì„ ì‚¬ìš©í•˜ì—¬ ë¸”ë¡ì„ ì±„ì›€ */
                        background-color: color-mix(in srgb, var(--c) 17%, #ffffff);

                        /* ì¢Œì¸¡ì— ë‘êº¼ìš´ ìƒ‰ìƒ ì•…ì„¼íŠ¸ ë¼ì¸ ì¶”ê°€ (ë¯¸ë‹ˆë©€ ë””ìì¸ì˜ í•µì‹¬) */
                        border-left: 4px solid var(--c);

                        /* ë¸”ë¡ì— ì–‡ê³  ë¯¸ì„¸í•œ í…Œë‘ë¦¬ ì¶”ê°€ (ìƒ‰ìƒ ê¸°ë°˜) */
                        border-top: 2px solid color-mix(in srgb, var(--c) 30%, #ffffff);
                        border-right: 2px solid color-mix(in srgb, var(--c) 30%, #ffffff);
                        border-bottom: 2px solid color-mix(in srgb, var(--c) 30%, #ffffff);
                    }

                    /* í˜¸ë²„ ì‹œ ê¹”ë”í•œ ì…ì²´ê° ì¶”ê°€ */
                    .course-block:hover {
                        transform: translateY(-1px); /* ì‚´ì§ ë„ìš°ê¸° */
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
                        opacity: 0.95;
                    }

                    /* ë¸”ë¡ ë‚´ë¶€ í…ìŠ¤íŠ¸ */
                    .course-block .slot {
                        line-height: 1.4;
                    }
                    .course-block .slot-title {
                        font-size: 14px;
                        font-weight: 700; /* ì œëª©ì€ í™•ì‹¤í•˜ê²Œ */
                        white-space: normal;
                        font-family: 'Inter', 'Pretendard', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
                    }
                    .course-block .slot-room {
                        margin-top: 3px;
                        font-size: 11px;
                        font-weight: 500;
                        opacity: 0.8;
                        color: #4b5563; /* ì–´ë‘ìš´ íšŒìƒ‰ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ìƒ‰ìƒ ëŒ€ë¹„ í™•ë³´ */
                    }

                    /* Responsive trims */
                    @media (max-width: 560px) {
                        .schedule-header,
                        .schedule-grid { grid-template-columns: 80px repeat(5, 1fr); }
                        .time-cell { font-size: 12px; }
                    }

                </style>
            </head>
            <body>
            <header>
                <h1><a href="/">SMULET</a></h1>
                <nav>
                    <a href="#"><b>ì´ìš©ì•ˆë‚´</b></a>
                    <a href="/login_page" id="loginLink"><b>ë¡œê·¸ì¸</b></a>
                    <a href="/Register" id="registerLink"><b>íšŒì›ê°€ì…</b></a>
                    <a href="/" id="logoutLink" style="display: none"><b>ë¡œê·¸ì•„ì›ƒ</b></a>
                    <a href="/" id="" style="display: none"><b>ë§ˆì´í˜ì´ì§€</b></a>
                </nav>
            </header>
            <main>
                <div class="container">
                    <!-- ì¢Œì¸¡: ëŒ€í‘œ ì‹œê°„í‘œ -->
                    <div class="representative-container">
                        <div class="box representative-box">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h2 id="representativeTitle" class="card-title">
                                    <span class="icon">ğŸ“Œ</span> ëŒ€í‘œ ì‹œê°„í‘œ
                                </h2>
                            </div>
                            <div id="representativeScheduleContainer">
                                <div class="schedule-card" id="repGridCard">
                                    <div class="schedule-header">
                                        <div class="time-col"></div>
                                        <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div>
                                    </div>
                                    <div class="schedule-body" id="repGridBody"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar">
                        <!-- BOX1 -->
                        <div class="box box1">
                            <h2 class="card-title"><span class="icon">ğŸ“…</span> ì‹œê°„í‘œ</h2>
                            <p class="subtext">ì‹œê°„í‘œë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!</p>

                            <!-- ë“œë¡­ë‹¤ìš´ë§Œìœ¼ë¡œ ë°”ë¡œ í•™ê¸° ì¶”ê°€ -->
                            <div style="margin-top: 1px">
                                <select id="semesterSelectInline" style="min-width: 220px">
                                    <option value="">í•™ê¸°ë¥¼ ì„ íƒí•´ ì¶”ê°€</option>
                                    <!-- JSì—ì„œ ì˜µì…˜ ì±„ì›Œì§ -->
                                </select>
                                <div id="scheduleModalMount"></div>
                            </div>

                            <ul id="semesterList" style="margin-top: 12px"></ul>
                            <!-- ì‹œê°„í‘œ ëª¨ë‹¬ -->
                        </div>

                        <div
                                id="modalOverlay"
                                class="modal-overlay hidden"
                                role="dialog"
                                aria-modal="true"
                                aria-labelledby="pwTitle"
                        >
                            <div class="modal-wrapper">
                                <div class="modal pw-modal">
                                    <p>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                                    <input type="password" id="pw" />
                                    <div class="modal-buttons">
                                        <button id="confirm" type="button">í™•ì¸</button>
                                        <button id="close-btn" type="button">ë‹«ê¸°</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- êµ¬ë¶„ë³„ ê³¼ëª© ëª©ë¡ ëª¨ë‹¬ -->
                        <div id="divisionModal" class="modal-overlay hidden">
                            <div class="modal-wrapper">
                                <div class="modal">
                                    <div style="flex:1">
                                        <h3 id="divisionModalTitle" style="margin-top:0; margin-bottom:12px; text-align:left;">
                                            ê³¼ëª© ëª©ë¡
                                        </h3>
                                        <ul id="divisionModalList"
                                            style="text-align:left; max-height:260px; overflow:auto; padding-left:18px; margin:0;">
                                        </ul>

                                        <div class="modal-buttons" style="margin-top:16px; justify-content:flex-end;">
                                            <button type="button" id="divisionModalClose">ë‹«ê¸°</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div id="changePwModal" class="modal-overlay hidden">
                            <div class="modal-wrapper">
                                <div class="modal pw-modal">
                                    <p>ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                                    <input
                                            type="password"
                                            id="newPassword"
                                            placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸"
                                    />
                                    <input
                                            type="password"
                                            id="confirmPassword"
                                            placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
                                    />
                                    <div class="modal-buttons">
                                        <button id="changePwBtn" type="button">ë³€ê²½</button>
                                        <button id="cancelChange" type="button">ì·¨ì†Œ</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BOX2 -->
                        <div class="box box2">
                            <h2 class="card-title"><span class="icon">ğŸŒ³</span> í…Œí¬íŠ¸ë¦¬</h2>
                            <p class="subtext">ëª¨ë“  í…Œí¬íŠ¸ë¦¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!</p>

                            <select
                                    id="techTreeSelect"
                                    onchange="goToTechTree()"
                                    style="margin-top: 1px"
                            >
                                <option value="">í•™ë²ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="21">21í•™ë²ˆ í…Œí¬íŠ¸ë¦¬</option>
                                <option value="22">22í•™ë²ˆ í…Œí¬íŠ¸ë¦¬</option>
                                <option value="23">23í•™ë²ˆ í…Œí¬íŠ¸ë¦¬</option>
                                <option value="24">24í•™ë²ˆ í…Œí¬íŠ¸ë¦¬</option>
                                <option value="25">25í•™ë²ˆ í…Œí¬íŠ¸ë¦¬</option>
                            </select>

                            <!-- ê°€ë¡œ ì •ë ¬ëœ ë°•ìŠ¤ë“¤ -->
                            <div class="details-container">
                                <div class="detail" id="bsmDetail">
                                    <span class="label">bsm</span>
                                    <span class="value" id="bsmCredit">0</span>
                                </div>
                                <div class="detail" id="designDetail">
                                    <span class="label">ì„¤ê³„</span>
                                    <span class="value" id="designCredit">0</span>
                                </div>
                                <div class="detail" id="majorElectiveDetail">
                                    <span class="label">ì „ê³µì„ íƒ</span>
                                    <span class="value" id="majorElectiveCredit">0</span>
                                </div>
                                <div class="detail" id="majorAdvancedDetail">
                                    <span class="label">ì „ê³µì‹¬í™”</span>
                                    <span class="value" id="majorAdvancedCredit">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="box box3">
                            <div class="section">
                                <h2 class="card-title"><span class="icon">ğŸ‘¤</span> ë‚´ ì •ë³´</h2>
                                <dl class="desc-list">
                                    <div>
                                        <dt>ì´ë¦„</dt>
                                        <dd><span id="userName"></span></dd>
                                    </div>
                                    <div>
                                        <dt>ì´ë©”ì¼</dt>
                                        <dd><span id="studentId"></span></dd>
                                    </div>
                                    <div>
                                        <dt>í•™ê³¼</dt>
                                        <dd><span id="userMajor">ì»´í“¨í„°ê³¼í•™ê³¼</span></dd>
                                    </div>
                                </dl>
                                <div class="section">
                                    <div class="section-header">
                                        <h3>ğŸ”’ íšŒì› ì„¤ì •</h3>
                                        <div class="actions">
                                            <button class="gray-btn" onclick="modifinguserinfo()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                                            <button class="red" onclick="deleteAccount()">
                                                íšŒì›íƒˆí‡´
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <!-- ì´ìš©ì•ˆë‚´ ëª¨ë‹¬: main.pageì™€ ë™ì¼ êµ¬ì¡° -->
            <div class="guide-backdrop" id="guideModal" aria-hidden="true">
                <div class="guide-modal" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
                    <header class="guide-head">
                        <h2 id="guideTitle" class="guide-title">SMULET ì´ìš©ì•ˆë‚´</h2>
                        <button class="guide-close" id="guideCloseBtn" type="button" aria-label="ë‹«ê¸° (Esc)">ë‹«ê¸°</button>
                    </header>

                    <div class="guide-body" id="guideContent" tabindex="-1">
                        <section class="guide-section">
                            <h3>ë¹ ë¥¸ ì‹œì‘ (60ì´ˆ ìš”ì•½)</h3>
                            <div class="guide-steps">
                                <div class="step"><strong>1) ë¡œê·¸ì¸/íšŒì›ê°€ì…</strong> â€” ìš°ì¸¡ ìƒë‹¨ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤. í† í° ë§Œë£Œ ì‹œ ìë™ ì¬ë°œê¸‰ ì‹¤íŒ¨í•˜ë©´ ì¬ë¡œê·¸ì¸í•˜ì„¸ìš”.</div>
                                <div class="step"><strong>2) ë§ˆì´í˜ì´ì§€</strong> â€” ì‹œê°„í‘œ ë§Œë“¤ê¸°/ë¶ˆëŸ¬ì˜¤ê¸°, ê³¼ëª© ì¶”ê°€Â·ì‚­ì œ, ì €ì¥ì„ í•  ìˆ˜ ìˆì–´ìš”.</div>
                                <div class="step"><strong>3) ëŒ€í‘œ ì‹œê°„í‘œ ì§€ì •</strong> â€” ê°€ì¥ ìµœê·¼ í•™ê¸°ë¥¼ ëŒ€í‘œë¡œ ì„¤ì •í•˜ë©´ ë©”ì¸ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                                <div class="step">
                                    <strong>4) í…Œí¬íŠ¸ë¦¬</strong> â€” 21~25í•™ë²ˆ í…Œí¬íŠ¸ë¦¬ë¥¼ ì„ íƒí•˜ë©´
                                    BSMÂ·ì„¤ê³„Â·ì „ê³µì„ íƒÂ·ì „ê³µì‹¬í™” ì´ìˆ˜ í•™ì ì„ í™•ì¸í•˜ê³ ,<br>
                                    ê³¼ëª©ë³„ ì„ ì´ìˆ˜Â·í›„ì´ìˆ˜ ê´€ê³„ë¥¼ í•œëˆˆì— ë³¼ ìˆ˜ ìˆì–´ìš”.
                                </div>
                            </div>
                        </section>

                        <section class="guide-section">
                            <h3>í•µì‹¬ ê¸°ëŠ¥ ê°€ì´ë“œ</h3>
                            <ul>
                                <li><strong>ë¡œê·¸ì¸ ë…¸ì¶œ ê·œì¹™</strong> â€” í† í°ì´ ìˆìœ¼ë©´ â€œë¡œê·¸ì¸/íšŒì›ê°€ì…â€ì€ ìˆ¨ê¹€, â€œë¡œê·¸ì•„ì›ƒ/ë§ˆì´í˜ì´ì§€â€ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</li>
                                <li><strong>ë§ˆì´í˜ì´ì§€ ì´ë™ ì˜¤ë¥˜(401)</strong> â€” ìë™ ì¬ë°œê¸‰ ì‹œë„ í›„ ì‹¤íŒ¨í•˜ë©´ ë¡œê·¸ì•„ì›ƒ ì•ˆë‚´ ë° ì¬ë¡œê·¸ì¸ í•„ìš”.</li>
                                <li><strong>ì‹œê°„í‘œ ì…ë ¥ íŒ</strong> â€” ê°™ì€ ì‹œê°„ëŒ€ ì¤‘ë³µ ì¶”ê°€ ë°©ì§€, ì‹œì‘Â·ì¢…ë£Œ ì‹œê°„ì´ ê°™ìœ¼ë©´ ë‹¨ì¼ ì‹œê°„ í‘œì‹œ.</li>
                                <li><strong>ëŒ€í‘œ ì‹œê°„í‘œ</strong> â€” ì—¬ëŸ¬ í•™ê¸° ì¤‘ ëŒ€í‘œë¡œ ì§€ì •í•˜ë©´ ë©”ì¸ ë°•ìŠ¤ì— ë Œë”ë§ë©ë‹ˆë‹¤.</li>
                                <li>
                                    <strong>í…Œí¬íŠ¸ë¦¬ í•™ë²ˆë³„ ì´ìˆ˜ í˜„í™©</strong> â€” 21~25í•™ë²ˆë³„ í…Œí¬íŠ¸ë¦¬ë¥¼ ì œê³µí•˜ë©°,
                                    ì‚¬ìš©ìì˜ ìˆ˜ê°• ë‚´ì—­ì„ ê¸°ë°˜ìœ¼ë¡œ BSMÂ·ì„¤ê³„Â·ì „ê³µì„ íƒÂ·ì „ê³µì‹¬í™” ì˜ì—­ë³„ ì´ìˆ˜ í•™ì ì´ ìë™ ì§‘ê³„ë©ë‹ˆë‹¤.
                                    ê° ê³¼ëª©ì˜ ì„ ì´ìˆ˜Â·í›„ì´ìˆ˜ ê´€ê³„ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ ì£¼ì–´
                                    ì–´ë–¤ ê³¼ëª©ì„ ë¨¼ì € ë“£ê³  ì´í›„ì— ë¬´ì—‡ì„ ë“¤ì„ì§€ í•™ë…„ë³„ íë¦„ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <h3>FAQ</h3>
                            <ul>
                                <li><strong>ë¡œê·¸ì¸ ë²„íŠ¼ì´ ì•ˆ ë³´ì—¬ìš”</strong> â€” ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœì…ë‹ˆë‹¤. ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</li>
                                <li><strong>ë§ˆì´í˜ì´ì§€ê°€ ì•ˆ ì—´ë ¤ìš”</strong> â€” í† í° ë§Œë£Œ ê°€ëŠ¥ì„±: ìƒˆë¡œê³ ì¹¨ í›„ ì¬ë¡œê·¸ì¸.</li>
                                <li><strong>ëŒ€í‘œ ì‹œê°„í‘œê°€ ë¹„ì–´ ìˆì–´ìš”</strong> â€” ë§ˆì´í˜ì´ì§€ì—ì„œ ì‹œê°„í‘œ ìƒì„±/ë¶ˆëŸ¬ì˜¤ê¸° í›„ â€œëŒ€í‘œë¡œ ì„¤ì •â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</li>
                            </ul>
                        </section>

                        <section class="guide-section">
                            <h3>ì •ì±… & ë¬¸ì˜</h3>
                            <p>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë° ì´ìš©ì•½ê´€ì€ í‘¸í„° ë§í¬ì—ì„œ í™•ì¸í•˜ì„¸ìš”. ë²„ê·¸/ì œì•ˆì€ ê¹ƒí—ˆë¸Œ(https://github.com/LimJinOuk/25_SCA_SMULET.git) ë˜ëŠ” <br> ë‹´ë‹¹ì(ì„ì§„ìš±:jinouk038@gmail.com)ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
                        </section>
                    </div>

                    <footer class="guide-footer">
                        <button class="guide-secondary" type="button" id="guideCopyLink">ì´ ì•ˆë‚´ ë³µì‚¬</button>
                        <button class="guide-primary" type="button" id="guideGotoMyPage">ë§ˆì´í˜ì´ì§€ë¡œ</button>
                    </footer>
                </div>
            </div>
            <footer>
                <b>
                    <a href="https://github.com/LimJinOuk/25_SCA_SMULET">Github</a>
                    <a href="/policy_page">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a><br><br>
                    <a href="#">Copyright</a>
                </b>
            </footer>

            <script>
                /***********************
                 * ìƒìˆ˜ / ì „ì—­ ìƒíƒœ
                 ***********************/
                const semesterOptions = [
                    '2025ë…„ 2í•™ê¸°','2025ë…„ 1í•™ê¸°','2024ë…„ 2í•™ê¸°','2024ë…„ 1í•™ê¸°',
                    '2023ë…„ 2í•™ê¸°','2023ë…„ 1í•™ê¸°','2022ë…„ 2í•™ê¸°','2022ë…„ 1í•™ê¸°',
                    '2021ë…„ 2í•™ê¸°','2021ë…„ 1í•™ê¸°',
                ];
                const pastelPalette = [
                    "#A5D8FF", // ë°ì€ íŒŒë‘
                    "#B2F2BB", // ë°ì€ ì—°ë‘
                    "#FFD8A8", // ì—°í•œ ì˜¤ë Œì§€
                    "#FFC9C9", // ë°ì€ ë¶„í™
                    "#D0BFFF", // ë°ì€ ë³´ë¼
                    "#B2E3E8", // ë°ì€ ì²­ë¡
                    "#FFE69A", // ë°ì€ ë…¸ë‘
                    "#F4C2D7", // ë°ì€ ìí™
                    "#C9E4A7", // ì—°í•œ ë…¹ìƒ‰
                    "#C7D2FE"  // ì—°í•œ ì¸ë””ê³ 
                ];

                const ColorManager = (() => {
                    const pool = [...pastelPalette];
                    for (let i = pool.length - 1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [pool[i],pool[j]]=[pool[j],pool[i]];}
                    const map = new Map(); let cursor = 0;
                    const nextPoolColor = (usedSet) => {
                        for (let i=0;i<pool.length;i++){ const idx=(cursor+i)%pool.length; const c=pool[idx]; if(!usedSet.has(c)){ cursor=(idx+1)%pool.length; return c; } }
                        return null;
                    };
                    const hslFromString = (s) => {
                        let hash=0; for (const ch of String(s)){ hash = ((hash<<5)-hash)+ch.charCodeAt(0); hash|=0; }
                        const h = Math.abs(hash)%360; return `hsl(${h}, 70%, 85%)`;
                    };
                    const get = (key) => {
                        if (!key) return pool[0];
                        if (map.has(key)) return map.get(key);
                        const used = new Set(map.values());
                        let color = nextPoolColor(used); if(!color) color = hslFromString(key);
                        map.set(key, color); return color;
                    };
                    const free = (key) => { if (!key) return; map.delete(key); };
                    const has  = (key) => map.has(key);
                    return { get, free, has };
                })();

                let UserId = null;
                let representativeTermCode = null; // "20252"
                let selectedSemesters = [];
                let timetableIdsBySemester = {};
                let _moreOpen = false; // ë”ë³´ê¸° í¼ì¹¨ ìƒíƒœ
                document.addEventListener('DOMContentLoaded', init);

                /***********************
                 * ê³µí†µ ìœ í‹¸
                 ***********************/

                function toSemesterCode(semText){
                    const m = String(semText).match(/(\d{4})\D*(1|2)\D*í•™ê¸°?/);
                    return m ? `${m[1]}${m[2]}` : semText.replace(/\D/g,'');
                }
                const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
                function periodLabel(p){
                    if (p===0) return '8~9ì‹œ';
                    const labels = ['9~10ì‹œ','10~11ì‹œ','11~12ì‹œ','12~1ì‹œ','1~2ì‹œ','2~3ì‹œ','3~4ì‹œ','4~5ì‹œ','5~6ì‹œ','6~7ì‹œ','7~8ì‹œ','8~9ì‹œ','9~10ì‹œ','10~11ì‹œ','11~12ì‹œ'];
                    return labels[p-1]||'';
                }
                function isTruthyTag(tag){
                    if (tag===true||tag===1) return true;
                    if (tag===false||tag===0) return false;
                    if (typeof tag==='string'){ const t=tag.trim().toLowerCase(); if(['t','true','1','y','yes'].includes(t)) return true; if(['f','false','0','n','no'].includes(t)) return false; }
                    return !!tag;
                }
                function pickTimetableArray(obj){
                    if (!obj || typeof obj!=='object') return [];
                    const candidates = Object.values(obj).filter(Array.isArray);
                    return candidates.find(arr => arr.some(r => r && typeof r==='object' && ('timetableId' in r || 'id' in r) && ('tag' in r || 'term' in r))) || [];
                }
                function toSemesterName(termCode){
                    const s = String(termCode||''); const year = s.slice(0,4); const sem = s.slice(4);
                    const label = sem==='1' ? '1í•™ê¸°' : sem==='2' ? '2í•™ê¸°' : '';
                    return (year && label) ? `${year}ë…„ ${label}` : 'ëŒ€í‘œ ì‹œê°„í‘œ';
                }

                /***********************
                 * í† í°/í†µì‹ 
                 ***********************/
                const TokenManager = (() => {
                    let accessToken = null;
                    let refreshingPromise = null;
                    const set = (t)=>{ accessToken = t || null; };
                    const get = ()=> accessToken;
                    const refresh = async () => {
                        if (refreshingPromise) return refreshingPromise;
                        refreshingPromise = (async () => {
                            const res = await fetch('/refreshT', { method:'POST', credentials:'include' });
                            if (!res.ok){ set(null); throw new Error('Refresh failed'); }
                            const auth = res.headers.get('Authorization');
                            if (!auth || !auth.startsWith('Bearer ')){ set(null); throw new Error('No Authorization header'); }
                            const token = auth.slice('Bearer '.length); set(token); return token;
                        })();
                        try { return await refreshingPromise; } finally { refreshingPromise = null; }
                    };
                    return { get, set, refresh };
                })();

                async function apiFetch(input, init = {}) {
                    const headers = new Headers(init.headers || {});
                    const token = TokenManager.get();
                    if (token) headers.set('Authorization', `Bearer ${token}`);
                    let res = await fetch(input, { ...init, headers, credentials: 'include' });
                    if (res.status === 401) {
                        try {
                            const newToken = await TokenManager.refresh();
                            const retryHeaders = new Headers(init.headers || {});
                            retryHeaders.set('Authorization', `Bearer ${newToken}`);
                            res = await fetch(input, { ...init, headers: retryHeaders, credentials: 'include' });
                        } catch (e) {
                            TokenManager.set(null);
                            throw e;
                        }
                    }
                    return res;
                }


                /***********************
                 * ì´ˆê¸°í™” & ì „ì—­ ì´ë²¤íŠ¸
                 ***********************/


                async function loadScheduleModalFragment() {
                    const mount = document.getElementById('scheduleModalMount');
                    if (!mount) return;
                    try {

                        const res = await fetch('/fragment/scheduleModal', { credentials: 'include' });
                        if (!res.ok) throw new Error(`Failed to load modal fragment (HTTP ${res.status})`);
                        const html = await res.text();
                        const temp = document.createElement('div');
                        temp.innerHTML = html;
                        const modalEl = temp.querySelector('#scheduleModal');
                        if (!modalEl) throw new Error('scheduleModal element not found');
                        // ì´ë¯¸ ìˆìœ¼ë©´ êµì²´ ë°©ì§€
                            if (!document.getElementById('scheduleModal')) {
                            document.body.appendChild(modalEl);   // âœ… bodyì— ì§ì ‘ ë¶€ì°©
                            }
                        // mountëŠ” ë¹„ì›Œë‘ (í•„ìš”ì‹œ: mount.innerHTML = '';)
                        // â¬‡ï¸ í”„ë˜ê·¸ë¨¼íŠ¸ ì£¼ì… ì™„ë£Œ ì‹ í˜¸
                        document.dispatchEvent(new CustomEvent('scheduleModal:fragment-ready'));
                    } catch (e) {
                        console.error('Schedule modal load failed:', e);
                    }
                }

                async function init() {
                    try {
                        await loadScheduleModalFragment(); // âœ… ëª¨ë‹¬ ë¨¼ì € ì£¼ì…
                        await TokenManager.refresh().catch(()=>{});
                        toggleAuthLinks(!!TokenManager.get());
                        bindGlobalEvents();
                        populateSemesterSelectInline();
                        if (TokenManager.get()) {
                            await bootstrapApp();
                        }
                    } catch (e) { console.error('Init error:', e); }
                }

                async function bootstrapApp() {
                    await loaduserinfo();
                    await hydrateSemestersFromServer();
                    await renderRepresentativeFromServer();
                    await loadCredits();
                }

                function toggleAuthLinks(isLoggedIn){
                    const loginLink    = document.getElementById('loginLink');
                    const logoutLink   = document.getElementById('logoutLink');
                    const registerLink = document.querySelector('nav a[href="/Register"]');
                    if (loginLink)     loginLink.style.display    = isLoggedIn ? 'none'  : 'inline';
                    if (logoutLink)    logoutLink.style.display   = isLoggedIn ? 'inline': 'none';
                    if (registerLink)  registerLink.style.display = isLoggedIn ? 'none'  : 'inline';
                }

                function bindGlobalEvents(){
                    document.getElementById('logoutLink')?.addEventListener('click', onLogoutClick);
                    document.getElementById('semesterSelectInline')?.addEventListener('change', onSemesterSelectInlineChange);

                    // âœ… êµ¬ë¶„ë³„ ì¹´ë“œ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
                    document.getElementById('bsmDetail')?.addEventListener('click', () => {
                        openDivisionModal('bsm');
                    });
                    document.getElementById('designDetail')?.addEventListener('click', () => {
                        openDivisionModal('design');
                    });
                    document.getElementById('majorElectiveDetail')?.addEventListener('click', () => {
                        openDivisionModal('majorElective');
                    });
                    document.getElementById('majorAdvancedDetail')?.addEventListener('click', () => {
                        openDivisionModal('majorAdvanced');
                    });

                    // âœ… êµ¬ë¶„ë³„ ê³¼ëª© ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
                    document.getElementById('divisionModalClose')?.addEventListener('click', closeDivisionModal);
                    document.getElementById('divisionModal')?.addEventListener('click', (e) => {
                        if (e.target.id === 'divisionModal') {
                            // ë°”ê¹¥(ì˜¤ë²„ë ˆì´) í´ë¦­ ì‹œ ë‹«ê¸°
                            closeDivisionModal();
                        }
                    });
                }


                function onLogoutClick(e){
                    e.preventDefault();
                    localStorage.removeItem('jwtToken');
                    localStorage.removeItem('refreshToken');
                    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.href = '/';
                }

                /***********************
                 * ì‚¬ìš©ì/ê³„ì • ê´€ë ¨
                 ***********************/
                async function loaduserinfo(){
                    return apiFetch('/userinfo', { method:'GET' })
                        .then(res=>{ if(!res.ok) throw new Error('ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'); return res.json(); })
                        .then(data=>{
                            document.getElementById('userName').textContent = data.name || '';
                            document.getElementById('studentId').textContent = data.email || '';
                            UserId = data.userId ?? data.id ?? data.timetables?.[0]?.userId ?? null;
                        })
                        .catch(err=>{
                            console.error(err);
                            alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        });
                }

                function deleteAccount() {
                    if (!confirm('ì •ë§ë¡œ íšŒì› íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
                    apiFetch('/member/delete', { method:'POST', headers:{'Content-Type':'application/json'} })
                        .then(res => { if(!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜'); return res.json(); })
                        .then(data => {
                            if (data.deleteStatus === 'success') {
                                alert('íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                localStorage.removeItem('jwtToken');
                                window.location.href = '/';
                            }
                        })
                        .catch(err => { alert('íšŒì› íƒˆí‡´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); console.error(err); });
                }

                function modifinguserinfo() {
                    const modalOverlay = document.getElementById('modalOverlay');
                    const closeBtn = document.getElementById('close-btn');
                    const confirmBtn = document.getElementById('confirm');

                    modalOverlay.classList.remove('hidden');
                    document.body.classList.add('modal-open');

                    closeBtn.onclick = () => {
                        modalOverlay.classList.add('hidden');
                        document.body.classList.remove('modal-open');
                    };

                    confirmBtn.onclick = () => {
                        const pw = document.getElementById('pw').value;
                        apiFetch('/check_pw_button', {
                            method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ pw })
                        })
                            .then(res => { if(!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜'); return res.json(); })
                            .then(data => {
                                if (data.Password === true) {
                                    alert('ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì™„ë£Œ!');
                                    modalOverlay.classList.add('hidden');
                                    document.getElementById('changePwModal').classList.remove('hidden');
                                } else {
                                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                                }
                            })
                            .catch(err => { alert('ìš”ì²­ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message); console.error(err); });
                    };
                }

                document.getElementById('changePwBtn').onclick = function () {
                    const newPw = document.getElementById('newPassword').value;
                    const confirmPw = document.getElementById('confirmPassword').value;
                    if (!newPw || !confirmPw || newPw !== confirmPw) { alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
                    apiFetch('/PWupdate_button', {
                        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ pw: newPw })
                    })
                        .then(async (res) => {
                            if (!res.ok) { const errorText = await res.text(); alert(`ì„œë²„ ì˜¤ë¥˜ ${res.status}: ${errorText}`); throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + res.status); }
                            return res.json();
                        })
                        .then((data) => {
                            if (data.updateStatus === true) {
                                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                document.getElementById('changePwModal').classList.add('hidden');
                            } else {
                                alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                        })
                        .catch((err) => { alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message); });
                };
                document.getElementById('close-btn').onclick = function () {
                    document.getElementById('modalOverlay').classList.add('hidden');
                };
                document.getElementById('cancelChange').onclick = function () {
                    document.getElementById('changePwModal').classList.add('hidden');
                };

                function goToTechTree() {
                    const select = document.getElementById('techTreeSelect');
                    const year = select.value;
                    const token = TokenManager.get();

                    if (!token) {
                        alert('ë¡œê·¸ì¸ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    if (!year) {
                        alert('í•™ë²ˆì„ ì„ íƒí•˜ì„¸ìš”.');
                        return;
                    }

                    select.value = "";

                    // âœ… ìƒˆ íƒ­ ì—´ê¸°: _blank + features ì—†ìŒ
                    const tab = window.open('', '_blank');
                    if (!tab) {
                        alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        return;
                    }

                    // ì—¬ê¸°ëŠ” ê¸°ì¡´ì²˜ëŸ¼ apiFetch ì‚¬ìš© (Authorization í—¤ë” í¬í•¨)
                    apiFetch(`/tech_tree?year=${encodeURIComponent(year)}`, { method: 'GET' })
                        .then(res => {
                            if (res.ok) return res.text();
                            throw new Error('Unauthorized');
                        })
                        .then(html => {
                            tab.document.open();
                            tab.document.write(html);
                            tab.document.close();
                        })
                        .catch(err => {
                            console.error(err);
                            tab.close();
                            alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
                            window.location.href = '/login_page';
                        });
                }


                // ===================== ì´ìš©ì•ˆë‚´ ëª¨ë‹¬ (ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼ ë™ì‘) =====================
                (function () {
                    const modal = document.getElementById('guideModal');
                    const closeBtn = document.getElementById('guideCloseBtn');
                    const content = document.getElementById('guideContent');
                    const gotoMyPageBtn = document.getElementById('guideGotoMyPage');
                    const copyBtn = document.getElementById('guideCopyLink');

                    // nav ì•ˆì—ì„œ "ì´ìš©ì•ˆë‚´" í…ìŠ¤íŠ¸ ê°€ì§„ a íƒœê·¸ ì°¾ê¸°
                    const guideLink = Array.from(document.querySelectorAll('nav a'))
                        .find(a => a.textContent && a.textContent.includes('ì´ìš©ì•ˆë‚´'));

                    let lastFocused = null;

                    function openGuide() {
                        if (!modal) return;
                        lastFocused = document.activeElement;
                        modal.classList.add('open');
                        modal.setAttribute('aria-hidden', 'false');
                        document.body.style.overflow = 'hidden';
                        setTimeout(() => content && content.focus(), 0);
                    }

                    function closeGuide() {
                        if (!modal) return;
                        modal.classList.remove('open');
                        modal.setAttribute('aria-hidden', 'true');
                        document.body.style.overflow = '';
                        if (lastFocused && typeof lastFocused.focus === 'function') {
                            lastFocused.focus();
                        }
                    }

                    // í¬ì»¤ìŠ¤ íŠ¸ë© & ESC
                    modal?.addEventListener('keydown', (e) => {
                        if (e.key === 'Tab') {
                            const focusables = modal.querySelectorAll(
                                'button, a[href], [tabindex]:not([tabindex="-1"])'
                            );
                            const list = Array.from(focusables).filter(el => !el.hasAttribute('disabled'));
                            if (!list.length) return;

                            const first = list[0];
                            const last = list[list.length - 1];

                            if (e.shiftKey && document.activeElement === first) {
                                e.preventDefault();
                                last.focus();
                            } else if (!e.shiftKey && document.activeElement === last) {
                                e.preventDefault();
                                first.focus();
                            }
                        }
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            closeGuide();
                        }
                    });

                    // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
                    modal?.addEventListener('click', (e) => {
                        if (e.target === modal) closeGuide();
                    });

                    closeBtn?.addEventListener('click', closeGuide);

                    // ìƒë‹¨ ë„¤ë¹„ "ì´ìš©ì•ˆë‚´" í´ë¦­ ì‹œ ì—´ê¸°
                    if (guideLink) {
                        guideLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            openGuide();
                        });
                    }

                    // ë§ˆì´í˜ì´ì§€ì—ì„œëŠ” ì´ë¯¸ ë§ˆì´í˜ì´ì§€ ì•ˆì´ë‹ˆê¹Œ ê·¸ëƒ¥ ë‹«ê¸°ë§Œ í•˜ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨ ì •ë„ë¡œ ì‚¬ìš©
                    gotoMyPageBtn?.addEventListener('click', () => {
                        // ì´ë¯¸ /my_page ì•ˆì´ë¼ë©´ ë‹«ê¸°ë§Œ
                        closeGuide();
                        // í˜¹ì‹œ ì£¼ì†Œ ê°•ì œ ì´ë™ì„ ì›í•˜ë©´ ì•„ë˜ì²˜ëŸ¼:
                        // window.location.href = '/my_page';
                    });

                    // "ì´ ì•ˆë‚´ ë³µì‚¬" ë²„íŠ¼
                    copyBtn?.addEventListener('click', async () => {
                        const text = content?.innerText.trim() ?? '';
                        try {
                            await navigator.clipboard.writeText(text);
                            copyBtn.textContent = 'ë³µì‚¬ë¨!';
                            setTimeout(() => (copyBtn.textContent = 'ì´ ì•ˆë‚´ ë³µì‚¬'), 1200);
                        } catch {
                            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
                        }
                    });

                    // ?guide=1 ì¿¼ë¦¬ë¡œ ë°”ë¡œ ì—´ê¸° ì§€ì› (ì„ íƒ ì‚¬í•­, ë©”ì¸ê³¼ ë™ì¼)
                    try {
                        const usp = new URLSearchParams(location.search);
                        if (usp.get('guide') === '1') openGuide();
                    } catch {}
                })();




                /***********************
                 * í•™ê¸°/ì‹œê°„í‘œ ê´€ë¦¬
                 ***********************/
                async function fetchLatestTimetableIdFromUserInfo(semesterCode,{tries=6,baseDelay=300}={}) {
                    if (!semesterCode) throw new Error('semesterCodeê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                    const termNum = Number(semesterCode);
                    const headers = { 'Cache-Control': 'no-cache' };
                    for (let i=0;i<tries;i++){
                        const res = await apiFetch(`/userinfo?_=${Date.now()}`, { headers, cache:'no-store', credentials:'include' });
                        if (res.ok){
                            const u = await res.json();
                            if (Array.isArray(u?.timetables)) {
                                const matches = u.timetables.filter(t=>Number(t.term)===termNum);
                                if (matches.length){
                                    const tid = matches.reduce((max,t)=>{
                                        const v = Number(t.timeTableId ?? t.timetableId ?? t.id);
                                        return Number.isFinite(v) ? Math.max(max,v) : max;
                                    }, 0);
                                    if (tid) return tid;
                                }
                            }
                        }
                        await sleep(baseDelay*(i+1));
                    }
                    return null;
                }

                async function createTimetableOnServer(semesterCode){
                    const fd = new FormData();
                    fd.append('semester', semesterCode);
                    const res = await apiFetch('/addTimetable', { method:'POST', body: fd, credentials:'include' });
                    const raw = await res.text();
                    if (!res.ok) throw new Error(`addTimetable ì‹¤íŒ¨ (${res.status}): ${raw}`);
                    try {
                        const j = JSON.parse(raw);
                        const directId = j.timeTableId ?? j.timetableId ?? j.id ?? j.data?.timeTableId ?? j.data?.id ?? null;
                        if (directId) return Number(directId);
                    } catch {}
                    const tid = await fetchLatestTimetableIdFromUserInfo(semesterCode, { tries:8, baseDelay:250 });
                    if (!tid) throw new Error('userinfoì—ì„œ timetableIdë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                    return tid;
                }

                function populateSemesterSelectInline(){
                    const select = document.getElementById('semesterSelectInline');
                    if (!select) return;
                    const prev = select.value;
                    select.innerHTML = '';
                    const placeholder = document.createElement('option'); placeholder.value = ''; placeholder.textContent = 'í•™ê¸°ë¥¼ ì„ íƒí•´ ì¶”ê°€'; select.appendChild(placeholder);
                    semesterOptions.forEach(sem=>{
                        if (!selectedSemesters.includes(sem)){
                            const opt = document.createElement('option'); opt.value=sem; opt.textContent=sem; select.appendChild(opt);
                        }
                    });
                    if ([...select.options].some(o=>o.value===prev)) select.value=prev; else select.value='';
                }

                async function onSemesterSelectInlineChange(e){
                    const semText = e.target.value;
                    if (!semText) return;
                    const semesterCode = toSemesterCode(semText);
                    try {
                        const tid = await createTimetableOnServer(semesterCode);
                        timetableIdsBySemester[semesterCode] = tid;
                        if (!selectedSemesters.includes(semText)) selectedSemesters.push(semText);
                        renderSemesterList();
                        populateSemesterSelectInline();
                        window.timetableIdsBySemester = timetableIdsBySemester;
                        e.target.value = '';
                    } catch(err){
                        console.error(err);
                        alert(`ì‹œê°„í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜: ${err.message}`);
                    }
                }

                function renderSemesterList() {
                    const list = document.getElementById('semesterList');
                    if (!list) return;

                    _moreOpen = false;
                    list.innerHTML = '';

                    const reps = [];
                    const others = [];
                    selectedSemesters.forEach(sem => {
                        const term = toSemesterCode(sem);
                        if (term === representativeTermCode) reps.push(sem);
                        else others.push(sem);
                    });

                    const makeRow = (sem, hidden) => {
                        const termCode = toSemesterCode(sem);
                        const tid = timetableIdsBySemester[termCode];

                        const li = document.createElement('li');
                        li.className = 'semester-item';
                        li.dataset.term = termCode;
                        if (hidden) li.classList.add('hidden-semester');

                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'semester-name';
                        nameSpan.textContent = sem;

                        const actions = document.createElement('div');
                        actions.className = 'semester-actions';

                        const delBtn = document.createElement('button');
                        delBtn.className = 'del-btn';
                        delBtn.title = 'ì‚­ì œ';
                        delBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
               stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6l-2 14H7L5 6"></path>
            <path d="M10 11v6"></path>
            <path d="M14 11v6"></path>
          </svg>`;
                        delBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            removeSemester(termCode, tid);
                        });

                        const label = document.createElement('label');
                        label.className = 'rep-label';
                        label.style.display = 'inline-flex';
                        label.style.alignItems = 'center';
                        label.style.gap = '6px';
                        label.addEventListener('click', (e) => e.stopPropagation());

                        const cb = document.createElement('input');
                        cb.type = 'checkbox';
                        cb.dataset.term = termCode;
                        cb.checked = (termCode === representativeTermCode);
                        cb.onchange = (e) => onToggleRepresentative(termCode, e.target.checked);

                        const labTxt = document.createElement('span');
                        labTxt.textContent = 'ëŒ€í‘œ';

                        label.appendChild(cb);
                        label.appendChild(labTxt);

                        actions.appendChild(delBtn);
                        actions.appendChild(label);

                        // âœ… í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸° (ëª¨ë‹¬ ì¤€ë¹„ ëŒ€ê¸° í¬í•¨)
                        li.addEventListener('click', async () => {
                            try {
                                await ensureModalReady();
                                window.openScheduleModal(sem);
                            } catch (e) {
                                console.error(e);
                                alert('ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                            }
                        });

                        // âœ… appendëŠ” ë°˜ë“œì‹œ ë¦¬ìŠ¤ë„ˆ "ë°”ê¹¥"ì—ì„œ!
                        li.appendChild(nameSpan);
                        li.appendChild(actions);
                        list.appendChild(li);
                    };

                    reps.forEach(sem => makeRow(sem, false));
                    others.forEach(sem => makeRow(sem, true));

                    const oldBtn = document.getElementById('showMoreBtn');
                    if (oldBtn) oldBtn.remove();

                    if (others.length > 0) {
                        const btn = document.createElement('button');
                        btn.id = 'showMoreBtn';
                        btn.textContent = `ë”ë³´ê¸° (${others.length})`;
                        btn.onclick = () => {
                            _moreOpen = !_moreOpen;
                            list.querySelectorAll('.semester-item').forEach(li => {
                                const term = li.dataset.term;
                                const isRep = (term === representativeTermCode);
                                if (!isRep) li.classList.toggle('hidden-semester', !_moreOpen);
                            });
                            btn.textContent = _moreOpen ? 'ì ‘ê¸°' : `ë”ë³´ê¸° (${others.length})`;
                        };
                        list.insertAdjacentElement('afterend', btn);
                    }
                }


                async function removeSemester(termCode, timetableId){
                    if (!Number.isInteger(timetableId)){ alert('ìœ íš¨í•œ timetableIdê°€ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
                    if (!confirm('ì´ í•™ê¸°ì˜ ì‹œê°„í‘œë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
                    try{
                        const res = await apiFetch('/deleteTimetable', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(timetableId) });
                        const txt = await res.text();
                        if (!res.ok) throw new Error(`ì‚­ì œ ì‹¤íŒ¨: ${txt}`);
                        const semText = toSemesterName(termCode);
                        selectedSemesters = selectedSemesters.filter(s=>s!==semText);
                        delete timetableIdsBySemester[termCode];
                        renderSemesterList(); populateSemesterSelectInline();
                        alert('ì‹œê°„í‘œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } catch(err){ alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message); console.error(err); }
                }

                async function onToggleRepresentative(termCode, checked) {
                    const tid = timetableIdsBySemester?.[termCode] ?? (await fetchLatestTimetableIdFromUserInfo(termCode));
                    if (!tid) { alert('timetableIdë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); renderSemesterList(); return; }

                    try {
                        const fd = new FormData(); fd.append('timetableId', String(tid)); fd.append('active', String(!!checked));
                        const res = await apiFetch('/representative_Timetable', { method:'POST', body: fd });
                        if (!res.ok) { const msg = await res.text(); throw new Error(msg || 'ëŒ€í‘œ ì„¤ì • ì‹¤íŒ¨'); }
                        if (checked) { representativeTermCode = termCode; alert('ëŒ€í‘œ ì‹œê°„í‘œë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
                        else { representativeTermCode = null; alert('ëŒ€í‘œ ì‹œê°„í‘œê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); }
                        await hydrateSemestersFromServer();
                        await renderRepresentativeFromServer();
                        renderSemesterList();
                    } catch (err) {
                        alert('ëŒ€í‘œ ì„¤ì • ì¤‘ ì˜¤ë¥˜: ' + err.message);
                        const cb = document.querySelector(`.rep-label input[type="checkbox"][data-term="${termCode}"]`);
                        if (cb) cb.checked = !checked;
                    }
                }

                async function hydrateSemestersFromServer(){
                    try{
                        const res = await apiFetch('/tableId_List', { method:'GET', credentials:'include' });
                        if (!res.ok) throw new Error(`ì‹œê°„í‘œ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ (HTTP ${res.status})`);
                        const data = await res.json();
                        const list = pickTimetableArray(data);
                        if (!Array.isArray(list) || list.length===0) return;

                        selectedSemesters.length = 0;
                        Object.keys(timetableIdsBySemester).forEach(k => delete timetableIdsBySemester[k])

                        for (const row of list){
                            const term = String(row.term ?? row['term'] ?? '');
                            const tid  = Number(row.timeTableId ?? row['timetableId'] ?? row.id);
                            const tagVal = row.tag ?? row['tag'];
                            if (isTruthyTag(tagVal)) representativeTermCode = term;
                            if (!term || !tid) continue;
                            timetableIdsBySemester[term] = tid;
                            const semText = toSemesterName(term);
                            if (!selectedSemesters.includes(semText)) selectedSemesters.push(semText);
                        }
                        renderSemesterList();
                        populateSemesterSelectInline();
                    } catch(err){ console.error('hydrateSemestersFromServer ì˜¤ë¥˜:', err); }
                }

                /***********************
                 * ëŒ€í‘œ ì‹œê°„í‘œ ë Œë”
                 ***********************/
    // âœ… minPeriod ~ maxPeriod ë²”ìœ„ë¡œ ê·¸ë¦¬ë“œ ìƒì„± (0êµì‹œê°€ ìˆìœ¼ë©´ ìœ„ì— ë‚˜ì˜¤ë„ë¡)
                function buildRepGridSpan(minPeriod, maxPeriod){
                    const body = document.getElementById('repGridBody');
                    if (!body) return;

                    body.innerHTML = '';

                    const grid = document.createElement('div');
                    grid.className = 'schedule-grid';
                    grid.id = 'repGridSpanBody';

                    // minPeriod ~ maxPeriod ê¹Œì§€ë¥¼ "ìœ„ì—ì„œë¶€í„° ìˆœì„œëŒ€ë¡œ" ë°°ì¹˜
                    for (let p = minPeriod; p <= maxPeriod; p++) {
                        const rowIndex = p - minPeriod + 1; // ì‹¤ì œ grid-row ê°’

                        // ì™¼ìª½ ì‹œê°„ ì…€
                        const t = document.createElement('div');
                        t.className = 'time-cell';
                        t.style.gridColumn = '1';
                        t.style.gridRow = String(rowIndex);
                        t.innerHTML = `${p}êµì‹œ<br/><span>${periodLabel(p)}</span>`;
                        grid.appendChild(t);

                        // ì›”~ê¸ˆ placeholder
                        for (let day = 0; day < 5; day++) {
                            const cell = document.createElement('div');
                            cell.className = 'cell-placeholder';
                            cell.dataset.day = String(day);
                            cell.dataset.period = String(p); // ì‹¤ì œ êµì‹œê°’ì€ ì—¬ê¸°ì— ì €ì¥
                            cell.style.gridColumn = String(day + 2);
                            cell.style.gridRow = String(rowIndex);
                            grid.appendChild(cell);
                        }
                    }

                    body.appendChild(grid);
                }

                function ensureRepGridSpanMax(periodMax){
                    const grid=document.getElementById('repGridSpanBody'); if(!grid) return;
                    const curRows = grid.querySelectorAll('[data-period]').length
                        ? Math.max(...Array.from(grid.querySelectorAll('[data-period]')).map(e=>Number(e.dataset.period)||1))
                        : 0;
                    if (periodMax <= curRows) return;
                    for (let p=curRows+1; p<=periodMax; p++){
                        const t=document.createElement('div'); t.className='time-cell';
                        t.style.gridColumn='1'; t.style.gridRow=String(p);
                        t.innerHTML = `${p}êµì‹œ<br/><span>${periodLabel(p)}</span>`;
                        grid.appendChild(t);
                        for (let day=0; day<5; day++){
                            const cell=document.createElement('div'); cell.className='cell-placeholder';
                            cell.dataset.day=String(day); cell.dataset.period=String(p);
                            cell.style.gridColumn=String(day+2); cell.style.gridRow=String(p);
                            grid.appendChild(cell);
                        }
                    }
                }
                function renderSlotHTML(subject, classroom, professor){
                    const sub = subject ?? ""; const room = classroom ? `<div class="slot-room">${classroom}</div>` : "";
                    return `<div class="slot"><div class="slot-title">${sub}</div>${room}</div>`;
                }

                function placeCourseBlockRep(item) {
                    const grid = document.getElementById('repGridSpanBody');
                    if (!grid) return;

                    const info = normalizeCourseInfo(item);

                    const subject = info.courseName;
                    const professor = info.professorName || '';
                    const classroom = info.classroom || '';
                    const courseCode = info.identifyNumberOfCourse || subject;

                    const dayIdx = (info.scheduleDay || 0) - 1;
                    if (dayIdx < 0 || dayIdx > 4) return;

                    const pStart = info.timeStart;
                    const pEnd = info.timeEnd ?? info.timeStart;
                    if (!Number.isFinite(pStart) || !Number.isFinite(pEnd)) return;
                    const rowStart = pStart - repMinPeriod + 1;
                    const rowEnd   = pEnd   - repMinPeriod + 1;
                    if (rowStart < 1 || rowEnd < rowStart) return;

                    const bg = ColorManager.get(courseCode);

                    const block = document.createElement('div');
                    block.className = 'course-block busy';
                    block.style.gridColumn = String(dayIdx + 2);
                    block.style.gridRow = `${rowStart} / ${rowEnd + 1}`;


                    block.style.setProperty('--course-color', bg);
                    block.dataset.courseId = courseCode;

                    block.innerHTML = renderSlotHTML(subject, classroom, professor);

                    // ğŸ”¥ ëª¨ë‹¬ JSì™€ ë™ì¼í•œ íŒ¨í„´ì˜ í˜¸ë²„ íˆ´íŒ
                    block.addEventListener('mouseenter', () => {
                        showCourseTooltip(block, info);
                    });
                    block.addEventListener('mouseleave', () => {
                        hideCourseTooltip();
                    });

                    grid.appendChild(block);

                    // ì•„ë˜ placeholderë“¤ border ì •ë¦¬ + ë°ì´í„° ì—°ê²°(í•„ìš”ì‹œ)
                    for (let r = pStart; r <= pEnd; r++) {
                        const ph = grid.querySelector(
                            `.cell-placeholder[data-day="${dayIdx}"][data-period="${r}"]`
                        );
                        if (ph) {
                            ph.style.borderBottom = 'none';
                            // í•„ìš”í•˜ë©´ ì…€ì—ì„œë„ íˆ´íŒ ë„ìš°ë ¤ê³  ì´ ì¤„ ì¶”ê°€:
                            ph.dataset.courseId = courseCode;
                        }
                    }
                }


                async function loadRepresentativeSchedule(getScheduleIds){
                    try {
                        const res = await apiFetch('/getTS2TE', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ getScheduleIds }),
                        });
                        if (!res.ok) throw new Error('ëŒ€í‘œ ì‹œê°„í‘œ ì¡°íšŒ ì‹¤íŒ¨');

                        const data = await res.json();
                        // ğŸ‘‰ ëª¨ë‹¬ì˜ currentCourseListì²˜ëŸ¼ ëŒ€í‘œ ì‹œê°„í‘œ ì „ìš© ë¦¬ìŠ¤íŠ¸ ë³´ê´€
                        repCourseList = Array.isArray(data) ? data : [];
                        console.log(repCourseList);
                        renderRepresentativeSchedule(repCourseList);
                    } catch (err) {
                        console.error(err);
                        alert('ëŒ€í‘œ ì‹œê°„í‘œ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
                    }
                }

                /***********************
                 * ì „ì²´ ê³¼ëª© ë¦¬ìŠ¤íŠ¸ ë¡œë”©
                 ***********************/
                async function ensureAllCourseListLoaded() {
                    // ì´ë¯¸ ë¡œë”©ë˜ì–´ ìˆìœ¼ë©´ ì¬ìš”ì²­ X
                    if (allCourseList && allCourseList.length > 0) return;

                    try {
                        // UserIdê°€ ì—†ë‹¤ë©´ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸°
                        const uid = UserId || (await window.getUserId?.());
                        if (!uid) {
                            console.warn('UserIdë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            return;
                        }

                        // 1) /getTCì—ì„œ ì „ì²´ courseId ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (timetableIdë¡œ í•„í„° X)
                        const byUid = await apiFetch('/getTC', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(uid),
                        });

                        if (!byUid.ok) {
                            const failTxt = await byUid.text();
                            console.error('ensureAllCourseListLoaded: /getTC ì‹¤íŒ¨', byUid.status, failTxt);
                            return;
                        }

                        let all;
                        try {
                            const txt = await byUid.text();
                            all = JSON.parse(txt);
                        } catch (e) {
                            console.error('ensureAllCourseListLoaded: /getTC JSON íŒŒì‹± ì‹¤íŒ¨', e);
                            return;
                        }

                        const rows = Array.isArray(all) ? all : [];
                        const courseIds = Array.from(
                            new Set(
                                rows
                                    .map(r => r.courseId ?? r.course_id ?? null)
                                    .filter(v => v != null && String(v).trim() !== '')
                            )
                        );

                        if (courseIds.length === 0) {
                            console.warn('ensureAllCourseListLoaded: courseIdê°€ ì—†ìŠµë‹ˆë‹¤.');
                            allCourseList = [];
                            return;
                        }

                        // 2) /getTS2TEì— ì „ì²´ courseIdë¥¼ ë³´ë‚´ì„œ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        const detailRes = await apiFetch('/getTS2TE', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ getScheduleIds: courseIds }),
                        });

                        if (!detailRes.ok) {
                            const msg = await detailRes.text();
                            console.error('ensureAllCourseListLoaded: /getTS2TE ì‹¤íŒ¨', detailRes.status, msg);
                            return;
                        }

                        const detail = await detailRes.json();
                        allCourseList = Array.isArray(detail) ? detail : [];
                        console.log('âœ… allCourseList ë¡œë”© ì™„ë£Œ:', allCourseList.length, 'ê°œ');
                    } catch (err) {
                        console.error('ensureAllCourseListLoaded ì˜¤ë¥˜:', err);
                    }
                }


                function renderRepresentativeSchedule(scheduleData) {
                    const container = document.getElementById('representativeScheduleContainer');
                    if (!container) return;

                    if (!document.getElementById('repGridBody')) {
                        container.innerHTML = `
          <div class="schedule-card" id="repGridCard">
            <div class="schedule-header">
              <div class="time-col"></div>
              <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div>
            </div>
            <div class="schedule-body" id="repGridBody"></div>
          </div>`;
                    }

                    const data = Array.isArray(scheduleData) ? scheduleData : [];

                    // âœ… ì‹¤ì œ ë°ì´í„° ê¸°ì¤€ìœ¼ë¡œ ìµœì†Œ/ìµœëŒ€ êµì‹œ ê³„ì‚° (0êµì‹œ ê³ ë ¤)
                    let minPeriod = Infinity;
                    let maxPeriod = -Infinity;

                    data.forEach(it => {
                        const s = Number(
                            it.time_start ?? it.timeStart ?? it.periodStart
                        );
                        const e = Number(
                            it.time_end ?? it.timeEnd ?? it.periodEnd ?? s
                        );

                        if (Number.isFinite(s)) minPeriod = Math.min(minPeriod, s);
                        if (Number.isFinite(e)) maxPeriod = Math.max(maxPeriod, e);
                    });

                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ 1~9êµì‹œ
                    if (!Number.isFinite(minPeriod) || !Number.isFinite(maxPeriod)) {
                        minPeriod = 1;
                        maxPeriod = 9;
                    } else {
                        // ìµœì†ŒëŠ” 0 ë˜ëŠ” 1, ìµœëŒ€ëŠ” ìµœì†Œ 9êµì‹œê¹Œì§€ ë³´ì¥
                        minPeriod = Math.min(minPeriod, 1);  // 0êµì‹œê°€ ìˆìœ¼ë©´ 0, ì•„ë‹ˆë©´ 1
                        maxPeriod = Math.max(maxPeriod, 9);
                    }

                    // ì „ì—­ ìƒíƒœë¡œ ì €ì¥ (ë¸”ë¡ ë°°ì¹˜ ë•Œ ì‚¬ìš©)
                    repMinPeriod = minPeriod;

                    // âœ… minPeriod ~ maxPeriodë¡œ ê·¸ë¦¬ë“œ ì¬êµ¬ì„±
                    buildRepGridSpan(minPeriod, maxPeriod);

                    const repGrid = document.getElementById('repGridSpanBody');
                    if (repGrid) {
                        repGrid.style.display = 'grid';
                        repGrid.style.gridAutoFlow = 'row dense';
                        repGrid.style.gridAutoRows = '62px';
                    }

                    // ì‹¤ì œ ë¸”ë¡ ë°°ì¹˜
                    data.forEach(placeCourseBlockRep);
                }



                async function renderRepresentativeFromServer(){
                    try { await TokenManager.refresh(); } catch {}
                    if (!UserId){ try { await loaduserinfo(); } catch {} }

                    const res = await apiFetch('/tableId_List', { method:'GET', credentials:'include' });
                    if (!res.ok) return;
                    const data = await res.json();
                    const list = pickTimetableArray(data);
                    const rep = list.find(row => isTruthyTag(row.tag ?? row['tag']));
                    if (!rep){
                        document.getElementById('representativeScheduleContainer').innerHTML = `<p style="color:#888;">ëŒ€í‘œ ì‹œê°„í‘œê°€ ì•„ì§ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>`;
                        document.getElementById('representativeTitle').textContent = 'ğŸ“Œ ëŒ€í‘œ ì‹œê°„í‘œ';
                        return;
                    }
                    const termCode = String(rep.term ?? rep['term'] ?? '');
                    const timetableId = Number(rep.timeTableId ?? rep['timeTableId'] ?? rep.timetableId ?? rep.id);
                    representativeTermCode = termCode;
                    document.getElementById('representativeTitle').textContent = `ğŸ“Œ ëŒ€í‘œ ì‹œê°„í‘œ - ${toSemesterName(termCode)}`;

                    const byUid = await apiFetch('/getTC', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(UserId) });
                    if (!byUid.ok){ const failTxt = await byUid.text(); console.error('getTC ì‹¤íŒ¨', byUid.status, failTxt); return; }
                    let all;
                    try { const txt = await byUid.text(); all = JSON.parse(txt); } catch(e){ console.error('[rep] /getTC JSON íŒŒì‹± ì‹¤íŒ¨:', e); return; }
                    const rows = (all||[]).filter(r=>{ const tid = Number(r.timeTableId ?? r.timetableId ?? r.tid ?? r.id); return Number.isFinite(tid) && tid === timetableId; });
                    const courseIds = Array.from(new Set(rows.map(r=> (r.courseId ?? r.course_id ?? null)).filter(v=>v!=null && String(v).trim()!=='')));
                    await loadRepresentativeSchedule(courseIds);
                }

                /***********************
                 * í•™ì  ë°•ìŠ¤
                 ***********************/
                async function fetchCreditData(endpoint) {
                    try {
                        const response = await apiFetch(endpoint, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(UserId) });
                        if (!response.ok) throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                        const data = await response.json();
                        if (Array.isArray(data)) return data.reduce((sum, v) => sum + Number(v || 0), 0);
                        return Number(data) || 0;
                    } catch (error) {
                        console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
                        return 0;
                    }
                }
                async function loadCredits() {
                    const bsm = await fetchCreditData("/getbsm");
                    const design = await fetchCreditData("/getì„¤ê³„");
                    const advanced = await fetchCreditData("/getì „ì‹¬");
                    const select = await fetchCreditData("/getì „ì„ ");
                    document.getElementById("bsmCredit").textContent = bsm;
                    document.getElementById("designCredit").textContent = design;
                    document.getElementById("majorAdvancedCredit").textContent = advanced;
                    document.getElementById("majorElectiveCredit").textContent = select;
                }

                /***********************
                 * ê³µìš© ë…¸ì¶œ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©)
                 ***********************/
                window.TokenManager = TokenManager;
                window.apiFetch = apiFetch;
                window.ColorManager = ColorManager;
                window.timetableIdsBySemester = timetableIdsBySemester;
                window.renderSlotHTML = renderSlotHTML;
                window.periodLabel = periodLabel;
                window.toSemesterCode = toSemesterCode;
                window.renderRepresentativeFromServer = renderRepresentativeFromServer;
                window.hydrateSemestersFromServer = hydrateSemestersFromServer;
                // UserId ì ‘ê·¼ì„ ìœ„í•´ helper ì œê³µ
                window.getUserId = async function() {
                    if (UserId) return UserId;
                    await loaduserinfo();
                    return UserId;
                };

                async function ensureModalReady() {
                    if (!(window.openScheduleModal && document.getElementById('scheduleModal'))) {
                        throw new Error('scheduleModal ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” í”„ë˜ê·¸ë¨¼íŠ¸ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                }


                function getDivisionLabel(info) {
                    if (info.bsm != null) {
                        return Number(info.bsm) === 1 ? "ì„¤ê³„" : "bsm";
                    }
                    if (info.ì „ì„ ì „ì‹¬ != null) {
                        return Number(info.ì „ì„ ì „ì‹¬) === 1 ? "ì „ê³µì„ íƒ" : "ì „ê³µì‹¬í™”";
                    }
                    return "-";
                }
                // ========== ê³µìš© íˆ´íŒ í•¨ìˆ˜ (ëª¨ë‹¬/ëŒ€í‘œ ì‹œê°„í‘œ ë‘˜ ë‹¤ ì‚¬ìš©) ==========
                function showCourseTooltip(anchor, courseInfo) {
                    // ê¸°ì¡´ íˆ´íŒ ì œê±°
                    hideCourseTooltip();

                    // í˜¹ì‹œ ì •ê·œí™”ê°€ ì•ˆ ëœ ê°ì²´ê°€ ë“¤ì–´ì™€ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
                    const info = normalizeCourseInfo(courseInfo || {});
                    const division = getDivisionLabel(info);
                    const code = info.identifyNumberOfCourse || '';
                    const credit = info.credit ?? '-';

                    // ìš”ì¼/ì‹œê°„ í…ìŠ¤íŠ¸ ìƒì„±
                    const weekdays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
                    let timeText = '-';
                    if (Number.isFinite(info.scheduleDay) && Number.isFinite(info.timeStart)) {
                        const dayName = weekdays[info.scheduleDay - 1] || `${info.scheduleDay}ìš”ì¼`;
                        const s = info.timeStart;
                        const e = info.timeEnd ?? info.timeStart;
                        timeText = (s === e)
                            ? `${dayName} ${s}êµì‹œ`
                            : `${dayName} ${s}~${e}êµì‹œ`;
                    }

                    // íˆ´íŒ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„± (ë””ìì¸ì€ CSSì—ì„œ ë‹´ë‹¹)
                    const tooltip = document.createElement('div');
                    tooltip.className = 'course-tooltip';

                    tooltip.innerHTML = `
      <div class="course-tooltip-header">
        <div>
              <div class="course-tooltip-title">${info.courseName || '-'}</div>
          <div class="course-tooltip-sub">
            ${code || '-'} <span class="dot"></span>
          </div>
        </div>
        <div class="course-tooltip-credit">${credit}í•™ì </div>
      </div>

      <div class="course-tooltip-body">
        <div class="course-tooltip-row">
          <span class="label">êµìˆ˜</span>
          <span class="value">${info.professorName || '-'}</span>
        </div>
        <div class="course-tooltip-row">
          <span class="label">ê°•ì˜ì‹¤</span>
          <span class="value">${info.classroom || '-'}</span>
        </div>
        <div class="course-tooltip-row">
          <span class="label">ì´ë©”ì¼</span>
          <span class="value">${info.email||'-'}</span>
        </div>
        <div class="course-tooltip-row">
          <span class="label">êµ¬ë¶„</span>
          <span class="value">${division}</span>
        </div>
      </div>
    `;

                    document.body.appendChild(tooltip);

                    // ìœ„ì¹˜ ê³„ì‚° (ì˜¤ë¥¸ìª½ì— ë¨¼ì € ë„ìš°ê³ , í™”ë©´ ë„˜ì¹˜ë©´ ì™¼ìª½/ìœ„ë¡œ ì¡°ì •)
                    const rect = anchor.getBoundingClientRect();
                    const ttRect = tooltip.getBoundingClientRect();

                    let left = rect.right + 8 + window.scrollX;
                    let top = rect.top + window.scrollY;

                    // ì˜¤ë¥¸ìª½ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ anchor ì™¼ìª½ì— ë¶™ì´ê¸°
                    if (left + ttRect.width > window.scrollX + window.innerWidth - 8) {
                        left = rect.left + window.scrollX - ttRect.width - 8;
                    }
                    // ì•„ë˜ë¡œë„ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ
                    if (top + ttRect.height > window.scrollY + window.innerHeight - 8) {
                        top = window.scrollY + window.innerHeight - ttRect.height - 8;
                    }

                    tooltip.style.left = left + 'px';
                    tooltip.style.top = top + 'px';
                }



                function hideCourseTooltip() {
                    document.querySelectorAll('.course-tooltip').forEach(el => el.remove());
                }

                // í•„ìš”í•˜ë©´ ì „ì—­ ë…¸ì¶œ
                window.showCourseTooltip = showCourseTooltip;
                window.hideCourseTooltip = hideCourseTooltip;

                /***********************
                 * ëŒ€í‘œ ì‹œê°„í‘œìš© ìƒíƒœ
                 ***********************/
                let repCourseList = [];  // getTS2TEì—ì„œ ë°›ì•„ì˜¨ ê³¼ëª©/ìŠ¬ë¡¯ ë°ì´í„° ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë³´ê´€
                let allCourseList = [];
                let repMinPeriod = 1;


                /***********************
                 * ê³¼ëª© ì •ë³´ ì •ê·œí™” (ê³µìš©)
                 ***********************/
                function normalizeCourseInfo(item) {
                    if (!item) return {
                        courseName: '',
                        identifyNumberOfCourse: '',
                        professorName: '',
                        classroom: '',
                        majorOrCulture: null,
                        bsm: null,
                        ì „ì„ ì „ì‹¬: null,
                        credit: '-',
                        scheduleDay: null,
                        timeStart: null,
                        timeEnd: null,
                    };

                    const termDay = Number(item.day ?? item.scheduleDay ?? 0);
                    const s = Number(item.timeStart ?? item.time_start ?? item.periodStart);
                    const e = Number(item.timeEnd   ?? item.time_end   ?? item.periodEnd ?? s);

                    return {
                        courseName: item.courseName || '',
                        identifyNumberOfCourse:
                            item.identifyNumberOfCourse ??
                            item.identify_number_of_course ??
                            item.courseCode ??
                            '',
                        professorName: item.professorName || '',
                        classroom: item.classroom || '',
                        majorOrCulture: item.majorOrCulture ?? null,
                        bsm: item.bsm ?? null,
                        // ì „ì„ /ì „ì‹¬ í•„ë“œëŠ” ì—¬ëŸ¬ ì´ë¦„ìœ¼ë¡œ ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ í•œ ë²ˆì— ì •ë¦¬
                        ì „ì„ ì „ì‹¬: item.ì „ì„ ì „ì‹¬ ?? item.majarS ?? item.majorS ?? null,
                        credit: item.credit ?? '-',
                        scheduleDay: Number.isFinite(termDay) ? termDay : null,
                        timeStart: Number.isFinite(s) ? s : null,
                        timeEnd:   Number.isFinite(e) ? e : null,
                    };
                }

                /***********************
                 * êµ¬ë¶„ë³„ ê³¼ëª© ëª¨ë‹¬
                 ***********************/
                function closeDivisionModal() {
                    const modal = document.getElementById('divisionModal');
                    if (!modal) return;
                    modal.classList.add('hidden');
                    document.body.classList.remove('modal-open');
                }

                async function openDivisionModal(kind) {
                    const modal = document.getElementById('divisionModal');
                    const titleEl = document.getElementById('divisionModalTitle');
                    const listEl  = document.getElementById('divisionModalList');
                    if (!modal || !titleEl || !listEl) return;

                    // âœ… ëŒ€í‘œ ì‹œê°„í‘œê°€ ì•„ë‹ˆë¼ "ì „ì²´ ìˆ˜ê°• ê³¼ëª©" ê¸°ì¤€ìœ¼ë¡œ ëª¨ë‹¬ì„ ë„ìš°ê¸°
                    await ensureAllCourseListLoaded();

                    // ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì•ˆë‚´
                    if (!allCourseList || allCourseList.length === 0) {
                        alert('ìˆ˜ê°•í•œ ê³¼ëª© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (ì „ì²´ courseId ê¸°ì¤€ ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.)');
                        return;
                    }

                    const labelMap = {
                        bsm: 'BSM',
                        design: 'ì„¤ê³„',
                        majorElective: 'ì „ê³µì„ íƒ',
                        majorAdvanced: 'ì „ê³µì‹¬í™”',
                    };

                    // 1) ë¨¼ì € í•´ë‹¹ êµ¬ë¶„ì— ë§ëŠ” ê³¼ëª© í•„í„°ë§ (ì „ì²´ ê³¼ëª© ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©)
                    let filtered = allCourseList
                        .map(normalizeCourseInfo)
                        .filter(info => {
                            const division = getDivisionLabel(info);
                            if (kind === 'bsm')            return division === 'bsm';
                            if (kind === 'design')         return division === 'ì„¤ê³„';
                            if (kind === 'majorElective')  return division === 'ì „ê³µì„ íƒ';
                            if (kind === 'majorAdvanced')  return division === 'ì „ê³µì‹¬í™”';
                            return false;
                        });

                    // 2) í•™ìˆ˜ë²ˆí˜¸ ê¸°ì¤€ ì¤‘ë³µ ì œê±° (identifyNumberOfCourse)
                    const uniqueMap = new Map();
                    filtered.forEach(info => {
                        const code = info.identifyNumberOfCourse;
                        if (!uniqueMap.has(code)) {
                            uniqueMap.set(code, info);
                        }
                    });
                    filtered = Array.from(uniqueMap.values());

                    // 3) ëª¨ë‹¬ ë Œë”ë§
                    titleEl.textContent = `${labelMap[kind] || ''} ê³¼ëª© ëª©ë¡`;
                    listEl.innerHTML = '';

                    if (filtered.length === 0) {
                        const li = document.createElement('li');
                        li.textContent = 'í•´ë‹¹ êµ¬ë¶„ì— í•´ë‹¹ë˜ëŠ” ê³¼ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
                        listEl.appendChild(li);
                    } else {
                        filtered.forEach(info => {
                            const li = document.createElement('li');
                            li.style.marginBottom = '6px';

                            li.innerHTML =
                                `${info.courseName || '-'} `
                                + `(${info.identifyNumberOfCourse || '-'}) `
                                + ` - ${info.credit ?? '-'}í•™ì `;

                            listEl.appendChild(li);
                        });
                    }

                    modal.classList.remove('hidden');
                    document.body.classList.add('modal-open');
                }



                // ëŒ€í‘œ ì‹œê°„í‘œì—ì„œ ì“°ë ¤ê³  ì „ì—­ ë…¸ì¶œ
                window.normalizeCourseInfo = normalizeCourseInfo;

            </script>
            <script src="/jsCss/scheduleModal.js"></script>
            </body>
            </html>